# 네이버 스마트스토어 주문 자동화 툴

Streamlit으로 제작된 네이버 스마트스토어 주문 관리 대시보드입니다. 네이버 커머스 API를 활용하여 신규 주문을 조회하고, CJ대한통운 엑셀 서식에 맞춰 합배송 주문을 처리하며, 발급된 송장번호를 다시 네이버에 전송하여 발송 처리를 자동화합니다.

## ✨ 주요 기능

* **토큰 자동 갱신**: Access Token을 자동으로 발급 및 갱신하여 수동 입력이 필요 없습니다.
* **신규 주문 조회**: 'PAYED' 상태의 신규 주문 목록을 실시간으로 조회합니다.
* **주문 상세 조회**: 조회된 주문의 상세 정보(수취인, 상품 옵션 등)를 조회합니다.
* **배송 메모 포함**: '수취인 주소 조회' API를 추가 호출하여 배송 메모를 엑셀에 포함합니다.
* **[핵심] CJ대한통운 엑셀 생성 (합배송)**:
    * 동일한 수취인(이름, 전화, 주소 기준)의 여러 주문을 **하나의 행으로 자동 그룹화(Bundling)**합니다.
    * 상품명과 옵션, 수량을 집계하여 "상품명A (옵션1 2개, 옵션2 1개), 상품명B (1개)" 형식으로 자동 변환합니다.
    * CJ대한통운 엑셀 서식에 맞춰 즉시 다운로드할 수 있습니다.
* **[핵심] 네이버 일괄 발송 처리 (합배송 해제)**:
    * CJ에서 송장번호가 발급된 엑셀 파일을 업로드합니다.
    * 엑셀의 '대표 주문번호'를 기준으로 합배송되었던 **모든 주문을 다시 찾아내어(Un-bundling)**, 동일한 송장번호로 네이버 API를 통해 일괄 "발송 처리"합니다.

## 🛠️ 설치 및 환경설정

### 1. 프로젝트 복제

```bash
git clone [https://github.com/YOUR_USERNAME/YOUR_REPOSITORY.git](https://github.com/YOUR_USERNAME/YOUR_REPOSITORY.git)
cd YOUR_REPOSITORY
```

### 2. 필요 라이브러리 설치

프로젝트 폴더에 `requirements.txt` 파일을 생성하고 아래 내용을 붙여넣은 뒤, 다음 명령어를 실행합니다.

**`requirements.txt`**
```txt
streamlit
requests
pandas
python-dotenv
bcrypt
pybase64
openpyxl
```

**설치 명령어**
```bash
pip install -r requirements.txt
```

### 3. `.env` 환경 변수 설정 (필수)

프로젝트 최상위 폴더에 `.env` 파일을 생성하고, 네이버 커머스 API와 발송인 정보를 입력합니다. (이 파일은 `.gitignore`에 의해 업로드되지 않습니다.)

```ini
# .env.example
# 네이버 API 인증 정보
NAVER_CLIENT_ID="여러분의_Client_ID"
NAVER_CLIENT_SECRET="여러분의_Client_Secret"

# CJ 엑셀에 입력될 '보내는 분' 정보
SENDER_NAME="보내는분_성명"
SENDER_PHONE="보내는분_전화번호"
SENDER_ZIPCODE="보내는분_우편번호"
SENDER_ADDRESS="보내는분_주소(전체)"
```

## 🚀 사용 방법

1.  **Streamlit 앱 실행**
    ```bash
    streamlit run naver_order_ui.py
    ```

2.  **주문 조회**
    * 앱이 실행되면 'PAYED' 상태의 주문을 조회하기 위해 [주문조회] 버튼을 클릭합니다. (토큰은 자동으로 발급됩니다.)

3.  **발주확인 및 엑셀 다운로드**
    * 조회된 주문 중 처리할 주문을 선택하고 [선택한 주문 발주확인 및 상세조회] 버튼을 클릭합니다.
    * 상세 내역(배송 메모 포함)이 로드되면, 하단의 [CJ대한통운 엑셀 파일 다운로드] 버튼을 클릭합니다.

4.  **CJ대한통운 송장 발급 (수동)**
    * 다운로드한 `cj_upload_...xlsx` 파일을 CJ대한통운 택배 시스템(N-Plus 등)에 업로드하여 송장번호를 발급받습니다.
    * 송장번호가 포함된 엑셀 파일(예: `운송장출력데이터...csv`)을 다시 다운로드합니다.

5.  **네이버 일괄 발송 처리 (자동)**
    * Streamlit 앱 하단의 "네이버 일괄 발송 처리" 섹션으로 이동합니다.
    * CJ에서 받은 송장번호 엑셀 파일을 업로드합니다.
    * 컬럼(고객주문번호, 운송장번호)이 자동 매칭되는 것을 확인하고 [일괄 발송 처리 실행] 버튼을 클릭합니다.
    * 합배송되었던 모든 주문이 동일한 송장번호로 네이버에 자동 등록됩니다.
